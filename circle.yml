machine:
  xcode:
    version: 9.0
  environment:
    SCHEME: "Auth0.iOS"
    DEVICES: "iPhone 7 (11.0),iPhone 7 (10.2)"
    FASTLANE_EXPLICIT_OPEN_SIMULATOR: 2

dependencies:
  pre:
    - brew install swiftlint
  post:
    - mkdir -p fastlane/test_output
  cache_directories:
    - "Carthage/Build"
  override:
    - bundle install
    - bundle exec fastlane ios bootstrap

test:
  override:
    - bundle exec fastlane ios ci
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/scan/
    - cp fastlane/test_output/report.junit $CIRCLE_TEST_REPORTS/scan/report.xml
    - bash <(curl -s https://codecov.io/bash) -J 'Auth0'
